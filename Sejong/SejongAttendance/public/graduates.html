<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>수료생 관리 - 세종요리</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand-logo">
                <span class="logo-text">세종요리</span>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-category">수강 관리</div>
                <a href="index.html" class="nav-item">
                    수강생 관리
                </a>
                <a href="register.html" class="nav-item">
                    회원 등록
                </a>
                <a href="sheet.html" class="nav-item">
                    월간 출석부
                </a>
                <a href="tuition.html" class="nav-item">
                    수강료 관리
                </a>

                <div class="nav-category">소통</div>
                <a href="notice.html" class="nav-item">학원 공지</a>
                <a href="feed.html" class="nav-item">피드 관리</a>                <div class="nav-category toggle-category active" onclick="toggleNavSub(this)">기타</div>
                <div class="nav-sub-menu show">
                    <a href="javascript:void(0)" onclick="openSettingsModal()" class="nav-item">
                        <span class="material-icons" style="font-size: 1.2rem; margin-right: 8px;">settings</span>
                        수업 요일 설정
                    </a>
                    <a href="index.html?filter=archive" class="nav-item">수료생 보관함</a>
                    <a href="index.html?filter=trash" class="nav-item">휴지통</a>
                    <a href="stats.html" class="nav-item">통계 및 납부</a>
                </div>
                <a href="monitor.html" target="_blank" class="nav-item highlight">키오스크 모니터</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-wrapper">
            <header class="top-header">
                <div class="page-title" style="text-align: center; width: 100%;">
                    <h1
                        style="font-family: 'Batang', serif; font-size: 2rem; border-bottom: none; display: inline-block;">
                        수 료 생 관 리</h1>
                </div>
                <div class="header-actions" style="position: absolute; right: 20px;">
                    <a href="index.html" class="btn-primary" style="padding: 8px 16px;">수강생 관리로 이동</a>
                </div>
            </header>

            <div class="content-scroll">

                <!-- List -->
                <div class="member-list-container" style="margin-top: 20px;">
                    <div class="list-header">
                        <span>수료생 목록</span>
                        <span>상태</span>
                    </div>
                    <div id="graduateList">
                        <div class="loading">데이터를 불러오고 있습니다...</div>
                    </div>
                </div>

                <!-- Status Selection Modal -->
                <div id="statusModal" class="custom-modal-overlay">
                    <div class="custom-modal">
                        <div class="modal-buttons" style="flex-direction: column; gap: 10px;">
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Reusing existing script logic but potentially overriding render function -->
    <script src="script.js"></script>
    <script>
        // Override renderMembers to show COMPLETED students only
        const originalRenderMembers = renderMembers;
        const originalInitDashboard = initDashboard;

        // Override Init to change target element
        // script.js uses 'memberListEl' (id="memberList"). Here we have 'graduateList'
        // We can do a quick hack: assign window.memberListEl to our element

        document.addEventListener('DOMContentLoaded', () => {
            // The main script.js runs on DOMContentLoaded.
            // We need to wait or intervene.
            // Actually, script.js might fail if 'memberList' is missing.
            // Let's ensure we point to the right container.

            const container = document.getElementById('graduateList');

            // We can overwrite the render function from script.js
            window.renderMembers = function () {
                container.innerHTML = '';

                // Filter for COMPLETED
                let displayMembers = members.filter(m => m.status === 'completed');

                if (displayMembers.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">수료한 학생이 없습니다.</div>';
                    return;
                }

                // Create Table (Copy logic from script.js roughly or reuse?)
                // Reusing script.js logic is hard because it's monolithic.
                // I'll manually render here to be safe and simple.

                const table = document.createElement('table');
                table.className = 'ledger-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th rowspan="2">성명</th>
                            <th rowspan="2">주민등록번호</th>
                            <th rowspan="2">주소</th>
                            <th colspan="3">연락처</th>
                            <th rowspan="2">수강<br>시작일</th>
                            <th rowspan="2">비고<br>(과정)</th>
                            <th rowspan="2">상태</th>
                        </tr>
                        <tr>
                            <th>본인</th>
                            <th>자택</th>
                            <th>보호자</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;

                const tbody = table.querySelector('tbody');

                displayMembers.forEach(member => {
                    const status = member.status || 'completed';
                    const statusText = '수료';

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${member.name}</td>
                        <td>${member.resident_num || ''}</td>
                        <td>${member.address || ''} ${member.address_detail || ''}</td>
                        <td>${member.phone || ''}</td>
                        <td>${member.phone_home || ''}</td>
                        <td>${member.phone_guardian || ''}</td>
                        <td>${member.start_date || ''}</td>
                        <td>${member.course || ''}</td>
                        <td>
                            <span class="status-cell status-completed" style="color: green; cursor: pointer;">${statusText}</span>
                        </td>
                    `;

                    // Click to restore (REMOVED)
                    // const statusCell = tr.querySelector('.status-cell');
                    // statusCell.onclick = (e) => {
                    //    e.stopPropagation();
                    //    openStatusModal(member.id);
                    // };

                    tbody.appendChild(tr);
                });

                container.appendChild(table);
            };

            // Fetch data manually if script.js init didn't work (script.js checks for memberListEl)
            // script.js handles fetchData. We just need to trigger it.
            fetchData().then(renderMembers);
        });
    </script>
</body>

</html>
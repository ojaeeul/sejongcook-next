<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼ë“œ ê´€ë¦¬ - ì„¸ì¢…ìš”ë¦¬</title>
    <link rel="stylesheet" href="style.css?v=20260228_6">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="script.js?v=20260228_9" defer></script>
    <style>
        .feed-layout { display: flex; gap: 24px; }
        .feed-main { flex: 2; height: calc(100vh - 250px); overflow-y: auto; padding-right: 10px; }
        .feed-sidebar { flex: 1; display: flex; flex-direction: column; gap: 20px; height: calc(100vh - 250px); overflow-y: auto; padding-right: 10px;}
        .post-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; transition: transform 0.2s; cursor: pointer; border: 2px solid transparent; }
        .post-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-color: #e2e8f0; }
        .post-card.selected { border-color: #3b82f6; background-color: #f8fafc; }
        .post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .post-author { display: flex; align-items: center; gap: 10px; }
        .author-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; background-color: #94a3b8; }
        .post-meta span { font-weight: 600; display: block; color: #1e293b; }
        .post-meta small { color: #64748b; font-size: 0.8rem; }
        .post-content { color: #475569; line-height: 1.6; margin-bottom: 15px; white-space: pre-wrap; }
        .post-stats { border-top: 1px solid #f1f5f9; padding-top: 15px; display: flex; gap: 15px; font-size: 0.9rem; color: #64748b; }
        .reader-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .reader-card h4 { margin-top: 0; margin-bottom: 15px; color: #1e293b; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; display: inline-block; }
        .tag { background: #f1f5f9; padding: 4px 10px; border-radius: 16px; font-size: 0.85rem; color: #475569; display: inline-block; margin-bottom: 5px; margin-right: 5px;}
        .tag.yellow { background: #fef08a; color: #854d0e; }
        .tag.blue { background: #e0f2fe; color: #0369a1; }
        .comment-item { display: flex; gap: 12px; margin-bottom: 15px; }
        .comment-content { background: #f8fafc; padding: 12px; border-radius: 8px; flex: 1; font-size: 0.9rem; }
        .comment-meta { display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.8rem; color: #94a3b8; }
        .write-comment { border-top: 1px solid #e2e8f0; padding-top: 15px; margin-top: 15px; }
        .comment-input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
        .action-btns { display: flex; justify-content: space-between; align-items: center; }
        .submit-btn { background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .submit-btn:hover { background: #2563eb; }
        .btn-primary { background: #3b82f6; color: white; border: none; font-weight: 600; cursor: pointer; border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: background 0.2s; }
        .btn-primary:hover { background: #2563eb; }
        .feed-tabs { display: flex; gap: 20px; border-bottom: 1px solid #cbd5e1; margin-bottom: 20px; }
        .tab-item { padding: 10px 5px; cursor: pointer; color: #64748b; font-weight: 500; transition: color 0.2s; }
        .tab-item:hover { color: #3b82f6;}
        .tab-item.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; font-weight: 700; }
        
        /* Modal Styles */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; display: flex; justify-content:center; align-items:center; }
        .hidden { display: none !important; }
        .modal-content { background:white; padding:30px; border-radius:12px; width:600px; max-width:90%; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .modal-header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:20px; }
        .modal-header h2 { margin:0; font-size:1.4rem; color: #1e293b; }
        .close-btn { background:none; border:none; font-size:1.5rem; cursor:pointer; color: #94a3b8; }
        .close-btn:hover { color: #1e293b; }
        .form-group { margin-bottom:15px; }
        .form-group label { display:block; margin-bottom:5px; font-weight:600; color: #475569; }
        .form-control { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; box-sizing: border-box; font-family: inherit; }
        .form-control:focus { outline: none; border-color: #3b82f6; ring: 2px solid #bfdbfe; }
        .modal-footer { display:flex; justify-content:flex-end; gap:10px; margin-top: 20px; }
        
        .stat-btn { background: none; border: none; cursor: pointer; color: #64748b; padding: 4px 8px; border-radius: 4px; transition: background 0.2s;}
        .stat-btn:hover { background: #f1f5f9; color: #3b82f6; }
        .liked { color: #ef4444 !important; }

        /* Linter Fixes */
        .feed-controls { display: flex; justify-content: space-between; margin-bottom: 24px; margin-top: 10px; }
        .feed-filter-select { padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; min-width: 200px; color: #475569; outline: none; }
        .btn-compose { padding: 10px 24px; font-size: 0.95rem; }
        .icon-sm { font-size: 18px; }
        .icon-lg { font-size: 48px; margin-bottom: 10px; }
        .bg-instructor { background-color: #f59e0b; }
        .fw-600 { font-weight: 600; }
        .image-placeholder { background-color: #f8fafc; height: 300px; margin-top: 15px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; border: 2px dashed #cbd5e1; }
        .stat-icon { font-size: 16px; vertical-align: text-bottom; }
        .text-red { color: #ef4444; }
        .text-blue { color: #3b82f6; }
        .bg-admin { background-color: #3b82f6; }
        .tag-gray { background: #e2e8f0; font-weight: 600; }
        .text-gray { color: #94a3b8; }
        .flex-wrap-gap-8 { display: flex; gap: 8px; flex-wrap: wrap; }
        .reader-card-flex { flex: 1; }
        .avatar-sm-student { width: 32px; height: 32px; font-size: 0.8rem; background-color: #cbd5e1; }
        .comment-header-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .comment-author-name { font-weight: 700; color: #1e293b; }
        .tag-yellow-sm { font-size: 0.7rem; padding: 2px 6px; }
        .comment-text { margin: 0; color: #475569; }
        .avatar-sm-instructor { width: 32px; height: 32px; font-size: 0.8rem; background-color: #f59e0b; }
        .comment-content-admin { background-color: white; border: 1px solid #e2e8f0; }
        .secret-comment-label { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-size: 0.9rem; color: #475569; cursor: pointer; }
        .icon-sm-align-middle { font-size: 18px; vertical-align: middle; }
    </style>

</head>

<body>
    <div class="app-container">
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand-logo">
                <span class="logo-text">ì„¸ì¢…ìš”ë¦¬</span>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-category toggle-category active" onclick="toggleNavSub(this)">ìˆ˜ê°• ê´€ë¦¬</div>
                <div class="nav-sub-menu show">
                    <a href="register.html" class="nav-item">ìˆ˜ê°•ìƒ ë“±ë¡</a>
                    <a href="index.html" class="nav-item">ìˆ˜ê°•ìƒ ëŒ€ì¥</a>
                    <a href="index.html?filter=phonebook" class="nav-item">ì „í™”ë²ˆí˜¸ë¶€</a>
                    <a href="sheet.html" class="nav-item">ì›”ê°„ ì¶œì„ë¶€</a>
                </div>
                
                <div class="nav-category toggle-category active" onclick="toggleNavSub(this)">ìˆ˜ê°•ë£Œ</div>
                <div class="nav-sub-menu show">
                    <a href="tuition.html" class="nav-item">ìˆ˜ê°•ë£Œ ê´€ë¦¬</a>
                    <a href="ledger.html" class="nav-item">ìˆ˜ê°•ë£Œ ë‚©ë¶€ëŒ€ì¥</a>
                    <a href="paid_list.html" class="nav-item">ë‚©ë¶€ì™„ë£Œ ëª…ë‹¨</a>
                </div>
                
                <div class="nav-category toggle-category active" onclick="toggleNavSub(this)">ì†Œí†µ</div>
                <div class="nav-sub-menu show">
                    <a href="notice.html" class="nav-item">í•™ì› ê³µì§€</a>
                    <a href="feed.html" class="nav-item active">í”¼ë“œ ê´€ë¦¬</a>
                    <a href="wagashi.html" class="nav-item">í•™ì› í™ë³´</a>
                </div>
                
                <div class="nav-category toggle-category" onclick="toggleNavSub(this)">ì‹œí—˜ì§€</div>
                <div class="nav-sub-menu">
                    <div class="nav-category toggle-category" onclick="toggleNavSub(this)">í•œì‹ê¸°ëŠ¥ì‚¬</div>
                    <div class="nav-sub-menu">
                        <a href="javascript:void(0)" onclick="loadExamView('í•œì‹_2021')" class="nav-item">2021ë…„ í•œì‹</a>
                    </div>
                </div>                <div class="nav-category toggle-category active" onclick="toggleNavSub(this)">ê¸°íƒ€</div>
                <div class="nav-sub-menu show">
                    <a href="javascript:void(0)" onclick="openSettingsModal()" class="nav-item">
                        <span class="material-icons" style="font-size: 1.2rem; margin-right: 8px;">settings</span>
                        ìˆ˜ì—… ìš”ì¼ ì„¤ì •
                    </a>
                    <a href="index.html?filter=archive" class="nav-item">ìˆ˜ë£Œìƒ ë³´ê´€í•¨</a>
                    <a href="index.html?filter=trash" class="nav-item">íœ´ì§€í†µ</a>
                    <a href="stats.html" class="nav-item">í†µê³„ ë° ë‚©ë¶€</a>
                </div>
                <a href="monitor.html" target="_blank" class="nav-item highlight">í‚¤ì˜¤ìŠ¤í¬ ëª¨ë‹ˆí„°</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-wrapper">
            <header class="top-header">
                <button class="hamburger-btn" onclick="toggleSidebar()">
                    <span>MENU</span>
                    <span class="material-icons">menu</span>
                </button>
                <div class="page-title-container">
                    <h1 id="pageTitle" class="page-title-text">í”¼ ë“œ ê´€ ë¦¬</h1>
                </div>
                <div class="header-actions"></div>
            </header>

            <div class="content-scroll">
                <!-- Filter Dropdown & Write Button Strip -->
                <div class="feed-controls">
                    <select id="feedFilter" class="form-control feed-filter-select" title="í”¼ë“œ í•„í„°" onchange="renderFeeds()">
                        <option value="all">ì „ì²´ í”¼ë“œ ë³´ê¸°</option>
                        <option value="í•œì‹ê¸°ëŠ¥ì‚¬">í•œì‹ê¸°ëŠ¥ì‚¬ í”¼ë“œ</option>
                        <option value="ì–‘ì‹ê¸°ëŠ¥ì‚¬">ì–‘ì‹ê¸°ëŠ¥ì‚¬ í”¼ë“œ</option>
                        <option value="ì œê³¼ê¸°ëŠ¥ì‚¬ë°˜">ì œê³¼ê¸°ëŠ¥ì‚¬ í”¼ë“œ</option>
                        <option value="ì œë¹µê¸°ëŠ¥ì‚¬">ì œë¹µê¸°ëŠ¥ì‚¬ í”¼ë“œ</option>
                        <option value="ì•Œë¦¼ì¥">ì•Œë¦¼ì¥ í”¼ë“œ</option>
                    </select>
                    <button class="btn-primary btn-compose" onclick="openWriteModal()">
                        ìƒˆ ì‘ì„± <span class="material-icons material-icons icon-sm">send</span>
                    </button>
                </div>

                <div class="feed-layout">
                    <!-- Feed Timeline (Left) -->
                    <div class="feed-main">
                        <div class="feed-tabs">
                            <div class="tab-item active">í”¼ë“œ íƒ€ì„ë¼ì¸ (<span id="feedCount">0</span>)</div>
                        </div>

                        <!-- Posts will be injected here by Javascript -->
                        <div id="feedListContainer"></div>

                    </div>

                    <!-- Sidebar (Right) - Contextually changes based on selected post -->
                    <div class="feed-sidebar">
                        <div id="sidePanelEmpty" class="reader-card reader-card empty-state">
                            <span class="material-icons material-icons icon-lg">chat</span>
                            <p>ì¢Œì¸¡ íƒ€ì„ë¼ì¸ì—ì„œ í”¼ë“œë¥¼ ì„ íƒí•˜ì‹œë©´<br>ëŒ“ê¸€ê³¼ ì½ì€ ì‚¬ëŒ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        
                        <div id="sidePanelContent" class="side-panel-content">
                            <!-- Read By -->
                            <div class="reader-card">
                                <h4>ì½ì€ ì‚¬ëŒ (<span id="readersCount">0</span>)</h4>
                                <div id="readersContainer" class="flex-wrap-gap-8">
                                    <!-- Readers injected here -->
                                </div>
                            </div>
    
                            <!-- Comments -->
                            <div class="reader-card reader-card flex-1">
                                <h4>ëŒ“ê¸€ (<span id="commentsCount">0</span>)</h4>
    
                                <div id="commentsContainer" class="comments-container">
                                    <!-- Comments injected here -->
                                </div>
    
                                <!-- Write Box -->
                                <div class="write-comment">
                                    <input type="text" id="newCommentText" class="comment-input" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleCommentEnter(event)">
                                    <div class="action-btns">
                                        <div class="comment-hint">Enterí‚¤ë¥¼ ëˆŒëŸ¬ ì „ì†¡ê°€ëŠ¥</div>
                                        <button class="submit-btn" onclick="addComment()">ë“±ë¡</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Write Feed Modal (Hidden) -->
    <div id="writeFeedModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ìƒˆ í”¼ë“œ ì‘ì„±í•˜ê¸°</h2>
                <button class="close-btn" onclick="closeWriteModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label>ì‘ì„±ì ê¶Œí•œ</label>
                <select id="feedAuthor" class="form-control">
                    <option value="ì›ì¥">ì›ì¥</option>
                    <option value="ê°•ì‚¬" selected>ìš°í˜„ìŠ¹ ê°•ì‚¬ (ì œê³¼/ì œë¹µ)</option>
                    <option value="êµë¬´ë¶€">êµë¬´ì‹¤</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬(ë°˜ ì§€ì •)</label>
                <select id="feedCategory" class="form-control">
                    <option value="ì œê³¼ê¸°ëŠ¥ì‚¬ë°˜">ì œê³¼ê¸°ëŠ¥ì‚¬ë°˜</option>
                    <option value="ì œë¹µê¸°ëŠ¥ì‚¬ë°˜">ì œë¹µê¸°ëŠ¥ì‚¬ë°˜</option>
                    <option value="í•œì‹ê¸°ëŠ¥ì‚¬">í•œì‹ê¸°ëŠ¥ì‚¬</option>
                    <option value="ì–‘ì‹ê¸°ëŠ¥ì‚¬">ì–‘ì‹ê¸°ëŠ¥ì‚¬</option>
                    <option value="ì¼ì‹ê¸°ëŠ¥ì‚¬">ì¼ì‹ê¸°ëŠ¥ì‚¬</option>
                    <option value="ì•Œë¦¼ì¥">ì „ì²´ ì•Œë¦¼ì¥</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ë‚´ìš©</label>
                <textarea id="feedContent" class="form-control form-control feed-textarea" title="ë‚´ìš© ì…ë ¥" placeholder="ìˆ˜ê°•ìƒë¶„ë“¤ê»˜ ì „í•  ì¬ë¯¸ìˆëŠ” ìˆ˜ì—… ì†Œì‹ì´ë‚˜ ê³¼ì œë¥¼ ì ì–´ë³´ì„¸ìš”!"></textarea>
            </div>
            
            <div class="modal-footer">
                <button onclick="closeWriteModal()" class="btn-cancel">ì·¨ì†Œ</button>
                <button onclick="saveFeed()" class="submit-btn btn-submit-timeline">íƒ€ì„ë¼ì¸ì— ë“±ë¡</button>
            </div>
        </div>
    </div>

    <script>
        // Use LocalStorage to persist feeds during session, or fallback to default data
        const defaultFeeds = [
            {
                id: 1,
                authorRole: "ê°•ì‚¬",
                authorName: "ì´ì„¸ë¼ ê°•ì‚¬ (ì œê³¼/ì œë¹µ)",
                dateStr: "2026.02.28 14:30",
                category: "ì œê³¼ê¸°ëŠ¥ì‚¬ë°˜",
                categoryColor: "blue",
                content: "<strong>ì˜¤ëŠ˜ì€ ë²„í„° ìŠ¤í€ì§€ ì¼€ì´í¬ ì‹¤ìŠµ!</strong>\n\nì œê³¼ê¸°ëŠ¥ì‚¬ë°˜ ìˆ˜ê°•ìƒ ì—¬ëŸ¬ë¶„, ì˜¤ëŠ˜ ë²„í„° ìŠ¤í€ì§€ ì¼€ì´í¬(ê³µë¦½ë²•) ë§Œë“œì‹œëŠë¼ ì •ë§ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤! ğŸ‚\në°˜ì£½ ì˜¨ë„ì™€ ë¹„ì¤‘ ë§ì¶”ê¸°ê°€ ê¹Œë‹¤ë¡œì› ìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ë‹¤ë“¤ ë„ˆë¬´ í›Œë¥­í•˜ê²Œ ë¶€í’€ì–´ ì˜¬ëë„¤ìš”.\në‹¤ê°€ì˜¤ëŠ” í•„ê¸°ì‹œí—˜ë„ í™”ì´íŒ…ì…ë‹ˆë‹¤! âœ¨",
                hasImage: true,
                likes: 15,
                likedByMe: false,
                readers: ["ê¹€ì§€ì› ìˆ˜ê°•ìƒ", "ë°•ë¯¼ìˆ˜ ìˆ˜ê°•ìƒ", "ìµœìœ ë¦¬ ìˆ˜ê°•ìƒ", "ì •ë‹¤ì€ ìˆ˜ê°•ìƒ"],
                comments: [
                    {
                        authorType: "ìˆ˜ê°•",
                        authorName: "ê¹€ì§€ì›",
                        tag: "ìˆ˜ê°•ìƒ",
                        content: "ì„ ìƒë‹˜! ì˜¤ëŠ˜ ì˜¤ë¸ ì˜¨ë„ê°€ ì¡°ê¸ˆ ë†’ì•˜ë˜ ê²ƒ ê°™ì€ë°, ë‹¤ìŒ ì‹¤ìŠµ ë•ŒëŠ” ëª‡ ë„ë¡œ ë§ì¶”ëŠ” ê²Œ ì¢‹ì„ê¹Œìš”?",
                        timeAgo: "1ì‹œê°„ ì „",
                        bgColor: "#cbd5e1"
                    },
                    {
                        authorType: "ê°•ì‚¬",
                        authorName: "ì´ì„¸ë¼ ê°•ì‚¬",
                        content: "ì§€ì›ë‹˜~ ìš°ë¦¬ í•™ì› Bì˜¤ë¸ì´ ì˜¨ë„ê°€ 5ë„ ì •ë„ ë†’ê²Œ ì¡íˆëŠ” ê²½í–¥ì´ ìˆì–´ìš”! ë‹¤ìŒì—” 175ë„ë¡œ ì„¸íŒ…í•´ë³´ì„¸ìš”! ğŸ˜Š",
                        timeAgo: "55ë¶„ ì „",
                        bgColor: "#f59e0b",
                        isAdmin: true
                    }
                ]
            },
            {
                id: 2,
                authorRole: "ì›ì¥",
                authorName: "ì„¸ì¢…ìš”ë¦¬ í•™ì›ì¥",
                dateStr: "2026.02.26 09:00",
                category: "í•œì‹ê¸°ëŠ¥ì‚¬",
                categoryColor: "yellow",
                content: "ì•ˆë…•í•˜ì„¸ìš”. ì„¸ì¢…ìš”ë¦¬ì œê³¼í•™ì›ì…ë‹ˆë‹¤.\nì´ë²ˆ ì£¼ ê¸ˆìš”ì¼(3/6) í•œì‹ê¸°ëŠ¥ì‚¬ ê¸°ì´ˆë°˜ ìˆ˜ì—…ì€ í•™ì› ë‚´ë¶€ ì„¤ë¹„ ì ê²€(ì†Œë°© ì•ˆì „ ì ê²€)ìœ¼ë¡œ ì¸í•˜ì—¬ ì•ˆì „ìƒ ë¶€ë“ì´í•˜ê²Œ íœ´ê°•í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\në³´ê°• ì¼ì •ì€ ë‹¤ìŒ ì£¼ ì›”ìš”ì¼ ìˆ˜ì—… ì‹œê°„ì— ê°œë³„ ì•ˆë‚´í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
                hasImage: false,
                likes: 2,
                likedByMe: false,
                readers: ["ì´ì¬í˜• ìˆ˜ê°•ìƒ", "í™ê¸¸ë™ ìˆ˜ê°•ìƒ"],
                comments: []
            }
        ];

        let feedsData = [];
        let selectedFeedId = null;

        function loadFeeds() {
            const saved = localStorage.getItem('sejong_feeds');
            if (saved) {
                feedsData = JSON.parse(saved);
            } else {
                feedsData = JSON.parse(JSON.stringify(defaultFeeds));
                saveFeedsToLocal();
            }
        }

        function saveFeedsToLocal() {
            localStorage.setItem('sejong_feeds', JSON.stringify(feedsData));
        }

        function renderFeeds() {
            const container = document.getElementById('feedListContainer');
            const filter = document.getElementById('feedFilter').value;
            
            container.innerHTML = '';
            
            let filteredFeeds = feedsData;
            if (filter !== 'all') {
                filteredFeeds = feedsData.filter(f => f.category.includes(filter) || (filter === 'ì•Œë¦¼ì¥' && f.authorRole === 'ì›ì¥'));
            }
            
            document.getElementById('feedCount').textContent = filteredFeeds.length;
            
            filteredFeeds.sort((a,b) => b.id - a.id).forEach(feed => {
                const card = document.createElement('div');
                card.className = `post-card ${selectedFeedId === feed.id ? 'selected' : ''}`;
                card.onclick = () => selectFeed(feed.id);
                
                // Author tag colors
                let authorBg = "#94a3b8";
                if(feed.authorRole === "ê°•ì‚¬") authorBg = "#f59e0b";
                if(feed.authorRole === "ì›ì¥") authorBg = "#3b82f6";
                if(feed.authorRole === "êµë¬´ë¶€") authorBg = "#10b981";
                
                // Category badge colors
                let catClass = "tag";
                if(feed.category.includes("ì œê³¼") || feed.category.includes("ì œë¹µ")) catClass = "tag blue";
                if(feed.category.includes("ì–‘ì‹") || feed.category.includes("í•œì‹")) catClass = "tag yellow";
                
                let imageBlock = '';
                if(feed.hasImage) {
                    imageBlock = `
                        <div class="image-placeholder">
                            <span class="material-icons material-icons img-icon-lg">image</span>
                            <span>[ì°¸ë¶€ ì´ë¯¸ì§€]</span>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="post-header">
                        <div class="post-author">
                            <div class="author-avatar" style="background-color: ${authorBg};">${feed.authorRole}</div>
                            <div class="post-meta">
                                <span>${feed.authorName}</span>
                                <small>${feed.dateStr}</small>
                            </div>
                        </div>
                        <span class="${catClass} fw-600">${feed.category}</span>
                    </div>
                    <div class="post-content">${feed.content.replace(/\n/g, '<br>')}${imageBlock}</div>
                    <div class="post-stats">
                        <button class="stat-btn ${feed.likedByMe ? 'liked' : ''}" onclick="event.stopPropagation(); toggleLike(${feed.id})">
                            <span class="material-icons material-icons stat-icon">favorite</span> ì¢‹ì•„ìš” <strong>${feed.likes}</strong>
                        </button>
                        <button class="stat-btn">
                            <span class="material-icons material-icons stat-icon">chat_bubble</span> ëŒ“ê¸€ <strong>${feed.comments.length}</strong>
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            if (filteredFeeds.length === 0) {
                container.innerHTML = `<div class="empty-msg">ì‘ì„±ëœ í”¼ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            }
        }
        
        function selectFeed(id) {
            selectedFeedId = id;
            renderFeeds(); // re-render to highlight selected card
            
            const feed = feedsData.find(f => f.id === id);
            if(!feed) return;
            
            document.getElementById('sidePanelEmpty').style.display = 'none';
            document.getElementById('sidePanelContent').style.display = 'flex';
            
            // Render Readers
            document.getElementById('readersCount').textContent = feed.readers.length;
            const rContainer = document.getElementById('readersContainer');
            rContainer.innerHTML = '';
            feed.readers.forEach(r => {
                rContainer.innerHTML += `<span class="tag">${r}</span>`;
            });
            if(feed.readers.length === 0) rContainer.innerHTML = '<span class="empty-sm-msg">ì¡°íšŒí•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤.</span>';
            
            // Render Comments
            document.getElementById('commentsCount').textContent = feed.comments.length;
            const cContainer = document.getElementById('commentsContainer');
            cContainer.innerHTML = '';
            feed.comments.forEach(c => {
                const isAdmin = c.isAdmin ? 'background-color: white; border: 1px solid #e2e8f0;' : '';
                const tagHtml = c.tag ? `<span class="tag yellow tag yellow sm">${c.tag}</span>` : '';
                
                cContainer.innerHTML += `
                    <div class="comment-item">
                        <div class="author-avatar author-avatar sm md-avatar" style=" background-color: ${c.bgColor};">${c.authorType}</div>
                        <div class="comment-content" style="${isAdmin}">
                            <div class="comment-header-row">
                                <span class="comment-author-name">${c.authorName}</span>
                                ${tagHtml}
                            </div>
                            <p class="comment-text">${c.content}</p>
                            <div class="comment-meta">
                                <span>${c.timeAgo}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if(feed.comments.length === 0) {
               cContainer.innerHTML = '<div class="empty-msg-sm">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
            }
            
            // scroll to bottom of comments
            cContainer.scrollTop = cContainer.scrollHeight;
        }
        
        function handleCommentEnter(e) {
            if(e.key === 'Enter') {
                addComment();
            }
        }
        
        function toggleLike(id) {
            const feed = feedsData.find(f => f.id === id);
            if(feed) {
                if(feed.likedByMe) {
                    feed.likes--;
                    feed.likedByMe = false;
                } else {
                    feed.likes++;
                    feed.likedByMe = true;
                }
                saveFeedsToLocal();
                renderFeeds(); // refresh UI
            }
        }
        
        function addComment() {
            if(!selectedFeedId) return;
            const input = document.getElementById('newCommentText');
            const text = input.value.trim();
            if(!text) return;
            
            const feed = feedsData.find(f => f.id === selectedFeedId);
            feed.comments.push({
                authorType: "í•™ì›",
                authorName: "ê´€ë¦¬ì",
                tag: "í–‰ì •/ìš´ì˜",
                content: text,
                timeAgo: "ë°©ê¸ˆ ì „",
                bgColor: "#3b82f6",
                isAdmin: true
            });
            
            input.value = '';
            saveFeedsToLocal();
            selectFeed(selectedFeedId); // Re-render sidebar
            renderFeeds(); // Re-render feed card to update number
        }

        function openWriteModal() {
            document.getElementById('writeFeedModal').classList.remove('hidden');
            document.getElementById('feedContent').value = '';
        }
        
        function closeWriteModal() {
            document.getElementById('writeFeedModal').classList.add('hidden');
        }
        
        function saveFeed() {
            const authorRole = document.getElementById('feedAuthor').value;
            let authorName = authRoleMap(authorRole);
            const category = document.getElementById('feedCategory').value;
            const content = document.getElementById('feedContent').value.trim();
            
            if(!content) {
                alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const now = new Date();
            const dateStr = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            const newId = feedsData.length > 0 ? Math.max(...feedsData.map(f => f.id)) + 1 : 1;
            
            feedsData.push({
                id: newId,
                authorRole: authorRole,
                authorName: authorName,
                dateStr: dateStr,
                category: category,
                content: content,
                hasImage: false,
                likes: 0,
                likedByMe: false,
                readers: [],
                comments: []
            });
            
            saveFeedsToLocal();
            closeWriteModal();
            renderFeeds();
            
            // Automatically select the new feed
            selectFeed(newId);
        }
        
        function authRoleMap(role) {
            if(role === 'ì›ì¥') return "ì„¸ì¢…ìš”ë¦¬ í•™ì›ì¥";
            if(role === 'êµë¬´ë¶€') return "êµë¬´ë¶€ ë‹´ë‹¹ì";
            return "ìš°í˜„ìŠ¹ ê°•ì‚¬ (ì¡°ë¦¬)";
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadFeeds();
            renderFeeds();
            // Select first feed if exists
            if(feedsData.length > 0) {
                const maxId = Math.max(...feedsData.map(f => f.id));
                selectFeed(maxId);
            }
        });
    </script>
</body>

</html>
